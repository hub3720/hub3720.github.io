<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Medidor Cognitivo – Escala Aberta</title>

<style>
body {
    background: #000;
    color: #0f0;
    font-family: monospace;
    margin: 0;
    padding: 20px;
}
#screen {
    max-width: 900px;
    margin: auto;
}
textarea, input, button {
    width: 100%;
    background: #000;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 10px;
    margin-top: 10px;
    font-family: monospace;
}
button { cursor: pointer; }
.log { margin-top: 10px; white-space: pre-wrap; }
</style>
</head>

<body>
<div id="screen">
    <div class="log" id="log"></div>
    <input id="input" placeholder="Digite sua matéria favorita e pressione Enter">
</div>

<script>
/* ===============================
CONFIGURAÇÃO GROQ
=============================== */
const GROQ_API_KEY = "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";
const GROQ_MODEL = "llama-3.1-70b-versatile";

/* ===============================
ESTADO DO SISTEMA
=============================== */
let history = [];
let score = { imaginacao: 0, maturidade: 0 };
let phase = "start";

/* ===============================
UTIL
=============================== */
const log = txt => {
    document.getElementById("log").innerText += txt + "\n\n";
};
const input = document.getElementById("input");

/* ===============================
GROQ REQUEST
=============================== */
async function groq(prompt) {
    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${GROQ_API_KEY}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            model: GROQ_MODEL,
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7
        })
    });
    const data = await res.json();
    return data.choices[0].message.content;
}

/* ===============================
PROMPTS NÚCLEO
=============================== */
function questionPrompt(context) {
return `
Você é um avaliador de inteligência humana.
Gere UMA pergunta nova, adaptativa e original.
Objetivo: medir imaginação útil sob restrições reais.

Contexto até agora:
${context}

Regras:
- imponha pelo menos uma restrição
- evite perguntas genéricas
- force criação + adaptação
- não explique o porquê
`;
}

function evaluationPrompt(answer, context) {
return `
Avalie a resposta abaixo.

Critérios:
- utilidade sob restrição
- adaptação a limites
- consciência de falhas
- maturidade cognitiva

Resposta:
${answer}

Retorne APENAS números neste formato:
IMAGINACAO:+X
MATURIDADE:+Y
Onde X e Y são inteiros (0 a 5).
`;
}

/* ===============================
FLUXO
=============================== */
log("Sistema cognitivo inicializado.");
log("Informe sua matéria favorita.");

input.addEventListener("keydown", async e => {
    if (e.key !== "Enter") return;
    const value = input.value.trim();
    if (!value) return;
    input.value = "";

    if (phase === "start") {
        history.push(`Matéria favorita: ${value}`);
        log("> " + value);
        phase = "test";
        nextQuestion();
    } else {
        log("> " + value);
        history.push(value);
        await evaluate(value);
        nextQuestion();
    }
});

/* ===============================
NÚCLEO ADAPTATIVO
=============================== */
async function nextQuestion() {
    if (history.length > 18) {
        finish();
        return;
    }
    const q = await groq(questionPrompt(history.join("\n")));
    log(q);
}

async function evaluate(answer) {
    const evalText = await groq(evaluationPrompt(answer, history.join("\n")));
    const i = evalText.match(/IMAGINACAO:\+(\d+)/);
    const m = evalText.match(/MATURIDADE:\+(\d+)/);
    if (i) score.imaginacao += parseInt(i[1]);
    if (m) score.maturidade += parseInt(m[1]);
}

/* ===============================
FINALIZAÇÃO
=============================== */
function finish() {
    log("=== RESULTADO ===");
    log("Imaginação útil: " + score.imaginacao);
    log("Maturidade cognitiva: " + score.maturidade);
    log("Nível cognitivo atual: " + (score.imaginacao + score.maturidade));
    log("Escala aberta. Nenhum nível máximo.");
    input.disabled = true;
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokedex e Game</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background-color:#fff; display:flex; }

/* SIDEBAR */
.sidebar {
  width:200px;
  background:#f1f1f1;
  height:100vh;
  position:fixed;
  left:0;
  top:0;
  padding:20px;
  box-sizing:border-box;
  overflow-y:auto;
}
.sidebar h2 { margin-top:0; font-size:18px; }
.sidebar button { margin:5px 0; padding:8px 10px; width:100%; border:none; border-radius:5px; cursor:pointer; }

/* CONTENT */
.content { margin-left:200px; flex:1; display:flex; flex-direction:column; }
.search-container { display:flex; justify-content:center; padding:20px; }
.search-container input { width:90%; max-width:500px; padding:10px 15px; border:2px solid #000; border-radius:25px; font-size:16px; outline:none; }

/* POKEMON GRID */
.pokemon-container {
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:15px;
  padding:10px;
}

@media(max-width:900px){ .pokemon-container { grid-template-columns:repeat(2,1fr); } }
@media(max-width:600px){ .pokemon-container { grid-template-columns:1fr; } .content { margin-left:0; } }

/* POKEMON CARD */
.pokemon-card { width:100%; height:120px; border-radius:15px; display:flex; align-items:center; position:relative; color:#fff; font-weight:bold; text-align:center; padding-left:10px; box-sizing:border-box; opacity:0; transition:opacity 0.3s; cursor:pointer; }
.pokemon-card.show { opacity:1; }
.pokemon-card img.pokemon-img { width:100px; height:100px; margin-right:10px; }
.pokemon-number { position:absolute; top:5px; left:10px; font-size:14px; }
.pokemon-types { position:absolute; top:5px; right:25px; display:flex; gap:3px; }
.pokemon-type-img { width:15px; height:15px; }

/* DETAIL BOX */
.detail-box { position:absolute; top:5px; right:5px; padding:10px; border-radius:10px; max-width:180px; text-align:left; display:none; z-index:10; color:#fff; }
.detail-box h4 { margin:0 0 5px 0; font-size:14px; }
.detail-box p { margin:2px 0; font-size:12px; }
.close-btn { position:absolute; top:2px; right:2px; background:red; color:#fff; border:none; border-radius:50%; width:18px; height:18px; font-size:12px; cursor:pointer; }

/* LOAD MORE */
.load-more-container { display:flex; justify-content:center; margin:20px 0; }
.load-more-btn { padding:10px 20px; font-size:16px; border-radius:25px; border:2px solid #000; cursor:pointer; background-color:#fff; }

@media (max-width:600px) {
  .pokemon-card { height:100px; padding-left:5px; }
  .pokemon-card img.pokemon-img { width:70px; height:70px; }
  .pokemon-type-img { width:12px; height:12px; }
  .detail-box { max-width:140px; font-size:11px; }
  .sidebar { position:fixed; left:-220px; transition:0.3s; z-index:20; }
  .sidebar.show { left:0; }
  .sidebar-toggle { position:fixed; left:10px; top:10px; z-index:30; background:#000; color:#fff; border:none; padding:10px; border-radius:5px; cursor:pointer; }
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <button id="start-game-btn">Start Game</button>
  <button id="pokedex-btn" style="display:none;">Pokedex</button>
  <button id="my-pokemon-btn" style="display:none;">Pokemons</button>
</div>

<div class="content">
  <button class="sidebar-toggle" id="sidebar-toggle">☰</button>
  <div class="search-container" id="search-container">
    <input type="text" id="search" placeholder="Digite o nome do Pokémon...">
  </div>
  <div class="pokemon-container" id="pokemon-container"></div>
  <div class="load-more-container">
    <button id="load-more" class="load-more-btn">Carregar mais</button>
  </div>
</div>

<script>
const container=document.getElementById('pokemon-container');
const searchInput=document.getElementById('search');
const loadMoreBtn=document.getElementById('load-more');
const sidebar=document.getElementById('sidebar');
const sidebarToggle=document.getElementById('sidebar-toggle');
const startGameBtn=document.getElementById('start-game-btn');
const pokedexBtn=document.getElementById('pokedex-btn');
const myPokemonBtn=document.getElementById('my-pokemon-btn');
const searchContainer=document.getElementById('search-container');

const typeColors={ normal:"#A8A77A", fire:"#EE8130", water:"#6390F0", electric:"#F7D02C",
  grass:"#7AC74C", ice:"#96D9D6", fighting:"#C22E28", poison:"#A33EA1",
  ground:"#E2BF65", flying:"#A98FF3", psychic:"#F95587", bug:"#A6B91A",
  rock:"#B6A136", ghost:"#735797", dragon:"#6F35FC", dark:"#705746",
  steel:"#B7B7CE", fairy:"#D685AD" };

let currentView='pokedex'; 
let loadedCount=0;
const batchSize=150;
const totalPokemons=386;
const allPokemons=[];
let selectedPokemon=null;

function upper(str){ return str.toUpperCase(); }
async function fetchPokemon(id){ const res=await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`); return await res.json(); }
async function fetchPokemonSpecies(id){ const res=await fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`); return await res.json(); }

function clearContainer(){ container.innerHTML=''; }

function createPokemonCard(pokemon, showDetails=true, onSelect=null){
  const card=document.createElement('div');
  const primaryType=pokemon.types[0].type.name;
  card.classList.add('pokemon-card');
  card.style.backgroundColor=typeColors[primaryType]||"#777";

  const number=document.createElement('div');
  number.classList.add('pokemon-number');
  number.textContent=`#${pokemon.id.toString().padStart(3,'0')}`;
  card.appendChild(number);

  const typesContainer=document.createElement('div');
  typesContainer.classList.add('pokemon-types');
  pokemon.types.forEach(t=>{
    const img=document.createElement('img');
    img.src=`https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/${t.type.name}.svg`;
    img.classList.add('pokemon-type-img');
    typesContainer.appendChild(img);
  });
  card.appendChild(typesContainer);

  const img=document.createElement('img');
  img.src=pokemon.sprites.other['official-artwork'].front_default;
  img.alt=pokemon.name;
  img.classList.add('pokemon-img');
  card.appendChild(img);

  const name=document.createElement('div');
  name.textContent=upper(pokemon.name);
  card.appendChild(name);

  if(showDetails){
    const detailBox=document.createElement('div');
    detailBox.classList.add('detail-box');
    detailBox.style.backgroundColor=typeColors[primaryType];
    card.appendChild(detailBox);

    const closeBtn=document.createElement('button');
    closeBtn.classList.add('close-btn');
    closeBtn.textContent="X";
    closeBtn.addEventListener('click',e=>{ e.stopPropagation(); detailBox.style.display='none'; });
    detailBox.appendChild(closeBtn);

    card.addEventListener('click',async()=>{
      detailBox.style.display='block';
      detailBox.innerHTML='';
      detailBox.appendChild(closeBtn);

      const species=await fetchPokemonSpecies(pokemon.id);
      const flavor=species.flavor_text_entries.find(f=>f.language.name==="en")?.flavor_text.replace(/\n|\f/g,' ')||"No description.";

      let evolveLevel="•";
      if(species.evolution_chain){
        try{
          const evoRes=await fetch(species.evolution_chain.url);
          const evoData=await evoRes.json();
          const evoDetails=evoData.chain.evolves_to.find(e=>e.species.name===pokemon.name);
          if(evoDetails&&evoDetails.evolution_details.length>0) evolveLevel=evoDetails.evolution_details[0].min_level||"•";
        }catch(e){ evolveLevel="•"; }
      }

      detailBox.innerHTML+=`<h4>${upper(pokemon.name)}</h4>`;
      detailBox.innerHTML+=`<p>Evolve Level: ${evolveLevel}</p>`;
      detailBox.innerHTML+=`<p>${flavor}</p>`;
      detailBox.appendChild(closeBtn);
    });
  } else if(onSelect){
    card.addEventListener('click',()=>{ onSelect(pokemon); });
  }

  container.appendChild(card);
  setTimeout(()=>card.classList.add('show'),50);
}

async function loadBatch(){
  const start=loadedCount+1;
  const end=Math.min(loadedCount+batchSize,totalPokemons);
  const delay=30000/batchSize;

  for(let i=start;i<=end;i++){
    const pokemon=await fetchPokemon(i);
    allPokemons.push(pokemon);
    if(currentView==='pokedex') createPokemonCard(pokemon,true);
    await new Promise(res=>setTimeout(res,delay));
  }

  loadedCount+=(end-start+1);
  if(loadedCount>=totalPokemons) loadMoreBtn.style.display='none';

  const remainder=loadedCount%3;
  if(remainder>0){
    for(let i=0;i<3-remainder;i++){
      const filler=document.createElement('div');
      filler.style.visibility='hidden';
      container.appendChild(filler);
    }
  }
}

searchInput.addEventListener('input',()=>{
  const value=searchInput.value.toLowerCase();
  container.innerHTML='';
  allPokemons.filter(p=>p.name.includes(value)).forEach(p=>createPokemonCard(p,true));
});

loadMoreBtn.addEventListener('click',()=>{ loadBatch(); });
sidebarToggle.addEventListener('click',()=>{ sidebar.classList.toggle('show'); });

// START GAME
startGameBtn.addEventListener('click',async()=>{
  currentView='game';
  pokedexBtn.style.display='block';
  startGameBtn.style.display='none';
  myPokemonBtn.style.display='none';
  searchContainer.style.display='none';
  clearContainer();
  loadMoreBtn.style.display='none';
  const startersIds=[1,4,7,152,155,158,252,255,258]; 
  for(const id of startersIds){
    const p=await fetchPokemon(id);
    createPokemonCard(p,false,(pokemon)=>{
      selectedPokemon=p;
      startGameBtn.style.display='none';
      myPokemonBtn.style.display='block';
      alert("Você selecionou "+upper(pokemon.name));
    });
  }
});

// VOLTAR PARA POKEDEX
pokedexBtn.addEventListener('click',()=>{
  currentView='pokedex';
  pokedexBtn.style.display='none';
  myPokemonBtn.style.display='none';
  startGameBtn.style.display='block';
  searchContainer.style.display='flex';
  clearContainer();
  loadedCount=0;
  container.innerHTML='';
  loadMoreBtn.style.display='block';
  loadBatch();
});

// MOSTRAR POKEMON SELECIONADO
myPokemonBtn.addEventListener('click',()=>{
  if(!selectedPokemon) return alert("Selecione um Pokémon primeiro!");
  clearContainer();
  const p=selectedPokemon;
  createPokemonCard(p,true);
  loadMoreBtn.style.display='none';
  searchContainer.style.display='none';
});
loadBatch();
</script>

</body>
    </html>
